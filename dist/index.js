"use strict";var T=Object.create;var g=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var v=Object.getPrototypeOf,x=Object.prototype.hasOwnProperty;var E=(e,n)=>{for(var t in n)g(e,t,{get:n[t],enumerable:!0})},R=(e,n,t,a)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of P(n))!x.call(e,r)&&r!==t&&g(e,r,{get:()=>n[r],enumerable:!(a=A(n,r))||a.enumerable});return e};var I=(e,n,t)=>(t=e!=null?T(v(e)):{},R(n||!e||!e.__esModule?g(t,"default",{value:e,enumerable:!0}):t,e)),W=e=>R(g({},"__esModule",{value:!0}),e);var z={};E(z,{compareWatchedPaths:()=>u,deepEqual:()=>f,getAtPath:()=>m,getShallowDiff:()=>d,useRenderShield:()=>O,withRenderShield:()=>D});module.exports=W(z);var y=require("react");function d(e,n){if(Object.is(e,n))return{equal:!0,changedKeys:[],stableKeys:$(n)};if(!p(e)||!p(n))return{equal:!1,changedKeys:["(value)"],stableKeys:[]};let t=Object.keys(e),a=Object.keys(n),r=new Set([...t,...a]),s=[],i=[];for(let l of r){let o=e[l],c=n[l];Object.is(o,c)?i.push(l):s.push(l)}return{equal:s.length===0,changedKeys:s,stableKeys:i}}function p(e){return e!==null&&typeof e=="object"}function $(e){return p(e)?Object.keys(e):[]}function m(e,n){if(e==null)return;let t=M(n),a=e;for(let r of t){if(a==null)return;a=a[r]}return a}function u(e,n,t){let a=[],r=[];for(let s of t){let i=m(e,s),l=m(n,s);f(i,l)?r.push(s):a.push(s)}return{watchedChanged:a,watchedStable:r,watchedEqual:a.length===0}}function f(e,n,t=new WeakMap){if(Object.is(e,n))return!0;let a=C(e),r=C(n);if(!a||!r)return!1;let s=t.get(e);if(s&&s===n)return!0;if(t.set(e,n),Array.isArray(e)||Array.isArray(n)){if(!Array.isArray(e)||!Array.isArray(n)||e.length!==n.length)return!1;for(let o=0;o<e.length;o++)if(!f(e[o],n[o],t))return!1;return!0}let i=Object.keys(e),l=Object.keys(n);if(i.length!==l.length)return!1;for(let o of i)if(!Object.prototype.hasOwnProperty.call(n,o))return!1;for(let o of i)if(!f(e[o],n[o],t))return!1;return!0}function C(e){return e!==null&&typeof e=="object"}function M(e){let n=[],t=e.replace(/\[(\d+)\]/g,".$1");for(let a of t.split(".").filter(Boolean)){let r=Number(a);n.push(Number.isInteger(r)&&String(r)===a?r:a)}return n}var b=new Map,w=!1;function h(e){if(typeof process<"u"&&process.env&&process.env.NODE_ENV==="production")return;let t=U(e);b.set(t,{key:t,diff:e}),w||(w=!0,Promise.resolve().then(V))}function V(){for(let{diff:e}of b.values())B(e);b.clear(),w=!1}function B(e){let t=`[RenderShield] ${e.componentName?`<${e.componentName}>`:"<Component>"}`;console.groupCollapsed(t),console.log("Shielded:",e.shielded),console.log("Render count:",e.renderCount),console.log("Changed:",e.changedKeys),console.log("Stable:",e.stableKeys),(e.watchedChanged.length||e.watchedStable.length)&&(console.log("Watched changed:",e.watchedChanged),console.log("Watched stable:",e.watchedStable)),console.log("Severity:",e.severity),console.groupEnd()}function U(e){let n=e.componentName??"Anonymous",t=[e.shielded?"S1":"S0",e.severity,e.changedKeys.join(","),"|W|",e.watchedChanged.join(",")].join(":");return`${n}::${t}`}function O(e,n){let t=n??{},a=(0,y.useRef)(null),r=(0,y.useRef)(0);r.current+=1;let s=a.current,i=(0,y.useMemo)(()=>{if(s===null)return{shielded:!1,nextValue:e,shouldReportInitial:!!t.debug,initialDiff:{componentName:void 0,shielded:!1,renderCount:r.current,changedKeys:[],stableKeys:Object.keys(e??{}),watchedChanged:[],watchedStable:t.watch??[],severity:"Stable"}};if(typeof t.customCompare=="function"){let o=t.customCompare(s,e);return{shielded:o,nextValue:o?s:e,shouldReportInitial:!1,diff:S(s,e,t,r.current,o,!0)}}let l=d(s,e);if(t.watch&&t.watch.length>0){let o=u(s,e,t.watch),c=o.watchedEqual;return{shielded:c,nextValue:c?s:e,shouldReportInitial:!1,diff:S(s,e,t,r.current,c,!1,l,o)}}return{shielded:l.equal,nextValue:l.equal?s:e,shouldReportInitial:!1,diff:S(s,e,t,r.current,l.equal,!1,l)}},[e,t.watch?.join("|"),t.debug,t.customCompare]);return s===null?(a.current=e,i.shouldReportInitial&&i.initialDiff&&h(i.initialDiff),e):(t.debug&&i.diff&&h(i.diff),i.shielded?a.current:(a.current=e,e))}function S(e,n,t,a,r,s,i,l){let o=i?.changedKeys??j(e,n).changedKeys,c=i?.stableKeys??j(e,n).stableKeys,K=l?.watchedChanged??[],N=l?.watchedStable??[],k=s?"Custom compare triggered":l&&K.length>0?"Changed (watched key)":o.length>0?"Changed (non-UI key)":"Stable";return{componentName:void 0,shielded:r,renderCount:a,changedKeys:o,stableKeys:c,watchedChanged:K,watchedStable:N,severity:k}}function j(e,n){try{return d(e,n)}catch{return{equal:!1,changedKeys:["(unavailable)"],stableKeys:[]}}}var q=I(require("react"));function D(e,n){let t=n??{},a=e.displayName||e.name||"Component",r=q.default.memo(e,(s,i)=>{if(typeof t.customCompare=="function"){let o=t.customCompare(s,i);return t.debug&&h({componentName:a,shielded:o,renderCount:NaN,changedKeys:[],stableKeys:[],watchedChanged:[],watchedStable:[],severity:"Custom compare triggered"}),o}let l=d(s,i);if(t.watch&&t.watch.length>0){let o=u(s,i,t.watch),c=o.watchedEqual;return t.debug&&h({componentName:a,shielded:c,renderCount:NaN,changedKeys:l.changedKeys,stableKeys:l.stableKeys,watchedChanged:o.watchedChanged,watchedStable:o.watchedStable,severity:o.watchedChanged.length>0?"Changed (watched key)":l.changedKeys.length>0?"Changed (non-UI key)":"Stable"}),c}return t.debug&&h({componentName:a,shielded:l.equal,renderCount:NaN,changedKeys:l.changedKeys,stableKeys:l.stableKeys,watchedChanged:[],watchedStable:[],severity:l.changedKeys.length>0?"Changed (non-UI key)":"Stable"}),l.equal});return r.displayName=`withRenderShield(${a})`,r}0&&(module.exports={compareWatchedPaths,deepEqual,getAtPath,getShallowDiff,useRenderShield,withRenderShield});
//# sourceMappingURL=index.js.map