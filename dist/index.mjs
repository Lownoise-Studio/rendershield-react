import{useMemo as T,useRef as K}from"react";function h(e,n){if(Object.is(e,n))return{equal:!0,changedKeys:[],stableKeys:O(n)};if(!y(e)||!y(n))return{equal:!1,changedKeys:["(value)"],stableKeys:[]};let t=Object.keys(e),s=Object.keys(n),l=new Set([...t,...s]),a=[],i=[];for(let o of l){let r=e[o],c=n[o];Object.is(r,c)?i.push(o):a.push(o)}return{equal:a.length===0,changedKeys:a,stableKeys:i}}function y(e){return e!==null&&typeof e=="object"}function O(e){return y(e)?Object.keys(e):[]}function g(e,n){if(e==null)return;let t=q(n),s=e;for(let l of t){if(s==null)return;s=s[l]}return s}function u(e,n,t){let s=[],l=[];for(let a of t){let i=g(e,a),o=g(n,a);f(i,o)?l.push(a):s.push(a)}return{watchedChanged:s,watchedStable:l,watchedEqual:s.length===0}}function f(e,n,t=new WeakMap){if(Object.is(e,n))return!0;let s=S(e),l=S(n);if(!s||!l)return!1;let a=t.get(e);if(a&&a===n)return!0;if(t.set(e,n),Array.isArray(e)||Array.isArray(n)){if(!Array.isArray(e)||!Array.isArray(n)||e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(!f(e[r],n[r],t))return!1;return!0}let i=Object.keys(e),o=Object.keys(n);if(i.length!==o.length)return!1;for(let r of i)if(!Object.prototype.hasOwnProperty.call(n,r))return!1;for(let r of i)if(!f(e[r],n[r],t))return!1;return!0}function S(e){return e!==null&&typeof e=="object"}function q(e){let n=[],t=e.replace(/\[(\d+)\]/g,".$1");for(let s of t.split(".").filter(Boolean)){let l=Number(s);n.push(Number.isInteger(l)&&String(l)===s?l:s)}return n}var m=new Map,p=!1;function d(e){if(typeof process<"u"&&process.env&&process.env.NODE_ENV==="production")return;let t=k(e);m.set(t,{key:t,diff:e}),p||(p=!0,Promise.resolve().then(D))}function D(){for(let{diff:e}of m.values())N(e);m.clear(),p=!1}function N(e){let t=`[RenderShield] ${e.componentName?`<${e.componentName}>`:"<Component>"}`;console.groupCollapsed(t),console.log("Shielded:",e.shielded),console.log("Render count:",e.renderCount),console.log("Changed:",e.changedKeys),console.log("Stable:",e.stableKeys),(e.watchedChanged.length||e.watchedStable.length)&&(console.log("Watched changed:",e.watchedChanged),console.log("Watched stable:",e.watchedStable)),console.log("Severity:",e.severity),console.groupEnd()}function k(e){let n=e.componentName??"Anonymous",t=[e.shielded?"S1":"S0",e.severity,e.changedKeys.join(","),"|W|",e.watchedChanged.join(",")].join(":");return`${n}::${t}`}function A(e,n){let t=n??{},s=K(null),l=K(0);l.current+=1;let a=s.current,i=T(()=>{if(a===null)return{shielded:!1,nextValue:e,shouldReportInitial:!!t.debug,initialDiff:{componentName:void 0,shielded:!1,renderCount:l.current,changedKeys:[],stableKeys:Object.keys(e??{}),watchedChanged:[],watchedStable:t.watch??[],severity:"Stable"}};if(typeof t.customCompare=="function"){let r=t.customCompare(a,e);return{shielded:r,nextValue:r?a:e,shouldReportInitial:!1,diff:b(a,e,t,l.current,r,!0)}}let o=h(a,e);if(t.watch&&t.watch.length>0){let r=u(a,e,t.watch),c=r.watchedEqual;return{shielded:c,nextValue:c?a:e,shouldReportInitial:!1,diff:b(a,e,t,l.current,c,!1,o,r)}}return{shielded:o.equal,nextValue:o.equal?a:e,shouldReportInitial:!1,diff:b(a,e,t,l.current,o.equal,!1,o)}},[e,t.watch?.join("|"),t.debug,t.customCompare]);return a===null?(s.current=e,i.shouldReportInitial&&i.initialDiff&&d(i.initialDiff),e):(t.debug&&i.diff&&d(i.diff),i.shielded?s.current:(s.current=e,e))}function b(e,n,t,s,l,a,i,o){let r=i?.changedKeys??R(e,n).changedKeys,c=i?.stableKeys??R(e,n).stableKeys,w=o?.watchedChanged??[],C=o?.watchedStable??[],j=a?"Custom compare triggered":o&&w.length>0?"Changed (watched key)":r.length>0?"Changed (non-UI key)":"Stable";return{componentName:void 0,shielded:l,renderCount:s,changedKeys:r,stableKeys:c,watchedChanged:w,watchedStable:C,severity:j}}function R(e,n){try{return h(e,n)}catch{return{equal:!1,changedKeys:["(unavailable)"],stableKeys:[]}}}import P from"react";function v(e,n){let t=n??{},s=e.displayName||e.name||"Component",l=P.memo(e,(a,i)=>{if(typeof t.customCompare=="function"){let r=t.customCompare(a,i);return t.debug&&d({componentName:s,shielded:r,renderCount:NaN,changedKeys:[],stableKeys:[],watchedChanged:[],watchedStable:[],severity:"Custom compare triggered"}),r}let o=h(a,i);if(t.watch&&t.watch.length>0){let r=u(a,i,t.watch),c=r.watchedEqual;return t.debug&&d({componentName:s,shielded:c,renderCount:NaN,changedKeys:o.changedKeys,stableKeys:o.stableKeys,watchedChanged:r.watchedChanged,watchedStable:r.watchedStable,severity:r.watchedChanged.length>0?"Changed (watched key)":o.changedKeys.length>0?"Changed (non-UI key)":"Stable"}),c}return t.debug&&d({componentName:s,shielded:o.equal,renderCount:NaN,changedKeys:o.changedKeys,stableKeys:o.stableKeys,watchedChanged:[],watchedStable:[],severity:o.changedKeys.length>0?"Changed (non-UI key)":"Stable"}),o.equal});return l.displayName=`withRenderShield(${s})`,l}export{u as compareWatchedPaths,f as deepEqual,g as getAtPath,h as getShallowDiff,A as useRenderShield,v as withRenderShield};
//# sourceMappingURL=index.mjs.map